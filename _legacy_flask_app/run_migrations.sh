#!/bin/bash
#
# run_migrations.sh - Скрипт-обертка для безопасного выполнения миграций.
#
# Этот скрипт автоматически устанавливает временную переменную DATABASE_URL 
# для подключения к базе данных через localhost, не изменяя основной .env файл.
#

# Останавливаем выполнение при любой ошибке
set -e

# 1. Активируем виртуальное окружение
echo "Активация виртуального окружения..."
if [ -f .venv/bin/activate ]; then
    source .venv/bin/activate
else
    echo "Ошибка: Виртуальное окружение не найдено. Убедитесь, что вы запустили 'python -m venv .venv'"
    exit 1
fi

# 2. Устанавливаем переменную окружения для подключения к локальной БД
export DATABASE_URL="postgresql://prodvor:prodvor@localhost:5432/prodvor"
echo "Установлена временная DATABASE_URL для миграции."

# 3. Запускаем команду flask db с переданными аргументами ("$@")
echo "Выполнение команды: flask db $@"
flask db "$@"

echo ""
echo "Команда миграции успешно выполнена."
