
# API Документация

## Базовый URL

Все эндпоинты в этом документе указаны относительно базового URL:

`/api/v1`

## Аутентификация

Большинство эндпоинтов требуют аутентификации с помощью JWT токена. Токен должен быть передан в заголовке `Authorization` в формате `Bearer <token>`.

---

## Эндпоинты

### Главный

*   **`GET /`**
    *   **Описание:** Возвращает приветственное сообщение.
    *   **Ответ:**
        ```json
        {
          "message": "Hello, World!"
        }
        ```

### Аутентификация

*   **`POST /auth/register`**
    *   **Описание:** Регистрирует нового пользователя.
    *   **Тело запроса:**
        ```json
        {
          "email": "user@example.com",
          "password": "password123",
          "nickname": "MyNickname",
          "role": "Игрок",
          "city": "Москва",
          "firstName": "Иван",
          "lastName": "Иванов"
        }
        ```
    *   **Ответ:** Объект пользователя.

*   **`POST /auth/login`**
    *   **Описание:** Аутентифицирует пользователя, создает новую сессию и возвращает токены доступа и обновления.
    *   **Тело запроса:**
        ```json
        {
          "email": "user@example.com",
          "password": "password123"
        }
        ```
    *   **Ответ:**
        ```json
        {
          "accessToken": "...",
          "refreshToken": "...",
          "user": { ... }
        }
        ```

*   **`POST /auth/refresh`**
    *   **Описание:** Обновляет токен доступа, используя токен обновления.
    *   **Тело запроса:**
        ```json
        {
          "refreshToken": "..."
        }
        ```
    *   **Ответ:**
        ```json
        {
          "accessToken": "..."
        }
        ```

*   **`POST /auth/logout`**
    *   **Описание:** Завершает текущую сессию пользователя, делая токен обновления недействительным.
    *   **Тело запроса:**
        ```json
        {
          "refreshToken": "..."
        }
        ```
    *   **Ответ:**
        ```json
        {
          "message": "Successfully logged out"
        }
        ```

### Пользователи

*   **`GET /users/me`**
    *   **Описание:** Возвращает информацию о текущем аутентифицированном пользователе.
    *   **Ответ:** Объект пользователя.

*   **`GET /users`**
    *   **Описание:** Возвращает список всех пользователей.
    *   **Ответ:** Массив объектов пользователей.

*   **`GET /users/<user_id>`**
    *   **Описание:** Возвращает информацию о конкретном пользователе.
    *   **Ответ:** Объект пользователя.

*   **`POST /users`**
    *   **Описание:** Создает нового пользователя.
    *   **Тело запроса:**
        ```json
        {
          "nickname": "NewUser",
          "email": "new@example.com",
          "role": "Игрок",
          "city": "Санкт-Петербург",
          "firstName": "Петр",
          "lastName": "Петров",
          "password": "securepassword",
          "age": 25,
          "gender": "Мужской"
        }
        ```
    *   **Ответ:** Объект созданного пользователя.

*   **`PUT /users/<user_id>`**
    *   **Описание:** Обновляет информацию о пользователе.
    *   **Тело запроса:** Любое подмножество полей из ответа `GET /users/<user_id>`.
    *   **Ответ:** Объект обновленного пользователя.

*   **`POST /users/<user_id>/avatar`**
    *   **Описание:** Загружает аватар для пользователя. Запрос должен быть в формате `multipart/form-data`.
    *   **Ответ:** Объект обновленного пользователя.

*   **`POST /users/<user_id>/cover`**
    *   **Описание:** Загружает обложку для пользователя. Запрос должен быть в формате `multipart/form-data`.
    *   **Ответ:** Объект обновленного пользователя.

### Управление сессиями

*   **`GET /users/me/sessions`**
    *   **Описание:** Возвращает список всех активных сессий для текущего пользователя. Требует аутентификации.
    *   **Ответ:**
        ```json
        [
          {
            "id": 123,
            "isCurrent": false, 
            "userAgent": "Chrome on Windows",
            "ipAddress": "192.168.1.10",
            "lastActiveAt": "2025-10-26T10:00:00Z",
            "createdAt": "2025-10-26T09:00:00Z"
          }
        ]
        ```

*   **`DELETE /users/me/sessions/<session_id>`**
    *   **Описание:** Удаляет указанную сессию (по её `id`), делая соответствующий `refreshToken` недействительным. Нельзя удалить самую последнюю активную сессию. Требует аутентификации.
    *   **Ответ:**
        ```json
        {
          "success": true
        }
        ```

*   **`DELETE /users/me/sessions/all-except-current`**
    *   **Описание:** Удаляет все сессии текущего пользователя, кроме самой последней активной. Требует аутентификации.
    *   **Ответ:**
        ```json
        {
          "success": true
        }
        ```

### Команды

*   **`GET /teams`**
    *   **Описание:** Возвращает список всех команд.
    *   **Ответ:** Массив объектов команд.

*   **`GET /teams/<team_id>`**
    *   **Описание:** Возвращает информацию о конкретной команде.
    *   **Ответ:** Объект команды.

*   **`POST /teams`**
    *   **Описание:** Создает новую команду.
    *   **Тело запроса:**
        ```json
        {
          "name": "My Awesome Team",
          "captainId": 1,
          "game": "Футбол",
          "city": "Москва"
        }
        ```
    *   **Ответ:** Объект созданной команды.

*   **`POST /teams/<team_id>/apply`**
    *   **Описание:** Подает заявку на вступление в команду. Требует аутентификации.
    *   **Ответ:**
        ```json
        {
          "success": true,
          "message": "Заявка успешно отправлена"
        }
        ```

*   **`GET /teams/<team_id>/applications`**
    *   **Описание:** Возвращает список заявок на вступление в команду. Только для капитана команды.
    *   **Ответ:** Массив объектов пользователей, подавших заявки.

*   **`POST /teams/<team_id>/applications/<user_id>/respond`**
    *   **Описание:** Принимает или отклоняет заявку на вступление в команду. Только для капитана команды.
    *   **Тело запроса:**
        ```json
        {
          "action": "accept" 
        }
        ```
        *   `action` может быть `accept` или `decline`.
    *   **Ответ:** Сообщение об успешном выполнении.

### Спорт

*   **`GET /sports/`**
    *   **Описание:** Возвращает список всех видов спорта.
    *   **Ответ:** Массив объектов спорта.

*   **`POST /sports`**
    *   **Описание:** Создает новый вид спорта.
    *   **Тело запроса:**
        ```json
        {
          "name": "Баскетбол",
          "isTeamSport": true
        }
        ```
    *   **Ответ:** Объект созданного вида спорта.

### Прочее (Legacy)

*   **`GET /tournaments`**: Список турниров.
*   **`GET /tournaments/<tournament_id>`**: Информация о турнире.
*   **`POST /tournaments`**: Создание турнира.
*   **`GET /posts`**: Список постов.
*   **`POST /posts`**: Создание поста.
*   **`GET /posts/<post_id>/comments`**: Комментарии к посту.
*   **`POST /posts/<post_id>/comments`**: Создание комментария.
*   **`GET /playgrounds`**: Список площадок.
*   **`POST /playgrounds`**: Создание площадки.
*   **`GET /quests`**: Список квестов.
*   **`GET /achievements`**: Список достижений.
*   **`GET /sponsors`**: Список спонсоров.
*   **`POST /sponsors`**: Создание спонсора.
*   **`GET /profiles/player`**: Профили игроков.
*   **`GET /profiles/referee`**: Профили судей.
*   **`GET /profiles/coach`**: Профили тренеров.

