# Руководство по API

Этот документ описывает ключевые аспекты работы с API, включая аутентификацию, стандарты, основные эндпоинты и процесс обновления документации.

## 1. Аутентификация

Большинство эндпоинтов требуют аутентификации. API использует JWT (JSON Web Tokens) для защиты маршрутов.

**Как это работает:**
1.  Клиент отправляет учетные данные (email, пароль) на эндпоинт `POST /api/v1/auth/login`.
2.  В ответ сервер возвращает `accessToken` и `refreshToken`.
3.  Для доступа к защищенным эндпоинтам `accessToken` должен быть передан в заголовке `Authorization`.

**Формат заголовка:**
```
Authorization: Bearer <accessToken>
```

## 2. Общие стандарты

Эти стандарты применяются ко всем эндпоинтам для обеспечения консистентности.

### 2.1. Обработка ошибок

В случае ошибки (статус `4xx` или `5xx`) API возвращает JSON-объект, соответствующий схеме `Error` в OpenAPI.

**Пример:**
```json
{
  "error": "User not found",
  "details": "No user with the specified ID exists."
}
```

### 2.2. Пагинация

Для эндпоинтов, возвращающих списки, используется пагинация через query-параметры `?page=N&per_page=N`.

**Структура ответа:**
```json
{
  "data": [
    { "...": "..." }
  ],
  "meta": {
    "total": 100,
    "page": 1,
    "per_page": 20
  }
}
```

## 3. Ключевые эндпоинты

Базовый URL для всех запросов: `/api/v1`

### Аутентификация (`/auth`)

- **`POST /api/v1/auth/register`**: Регистрация нового пользователя.
- **`POST /api/v1/auth/login`**: Вход в систему, получение `accessToken` и `refreshToken`.
- **`POST /api/v1/auth/refresh`**: Обновление `accessToken` с помощью `refreshToken`.
- **`POST /api/v1/auth/logout`**: Выход из системы (делает `refreshToken` невалидным).

### Профиль пользователя (`/users`)

- **`GET /api/v1/users/me`**: Получение полной информации о текущем (авторизованном) пользователе.
- **`GET /api/v1/users/{user_id}`**: Получение публичной информации о пользователе по его ID.
- **`PUT /api/v1/users/me/settings`**: Обновление настроек интерфейса.
- **`PUT /api/v1/users/me/privacy`**: Обновление настроек приватности.

### Сессии пользователя (`/users/me/sessions`)

Этот набор эндпоинтов позволяет управлять активными сессиями пользователя.

- **`GET /api/v1/users/me/sessions`**: Возвращает список всех активных сессий пользователя. Каждая сессия содержит информацию об устройстве, IP-адресе и времени последней активности.
- **`DELETE /api/v1/users/me/sessions/{session_id}`**: Завершает (деактивирует) указанную сессию.
- **`DELETE /api/v1/users/me/sessions`**: Завершает все сессии, кроме текущей.

### Социальные взаимодействия (`/users`)

- **`GET /api/v1/users/{user_id}/friends`**: Получить список друзей пользователя (с пагинацией).
- **`GET /api/v1/users/{user_id}/followers`**: Получить список подписчиков пользователя (с пагинацией).
- **`GET /api/v1/users/{user_id}/following`**: Получить списки пользователей и команд, на которые подписан пользователь.

### Загрузка файлов (`/uploads`)

- **`POST /api/v1/uploads/initiate`**: Инициирует процесс загрузки файла. Возвращает `uploadId` и `presignedUrl` для прямой загрузки.
- **`POST /api/v1/uploads/complete`**: Завершает процесс загрузки и связывает файл с сущностью (например, `avatarUrl` у пользователя).

## 4. Обновление API документации (Swagger)

Проект использует статический файл `app/static/swagger.json` для OpenAPI спецификации.

**Важно:** Этот файл — единственный источник правды для фронтенда. После внесения изменений в бэкенд-эндпоинты, необходимо вручную обновить этот файл, чтобы фронтенд-команда могла регенерировать свой SDK.
